{% extends "base.html" %}
{% block content %}
<div class="shell">
  <header class="topbar">
    <div class="brand">My Cloud</div>
    <div class="actions">
      <button id="lock-btn" class="btn icon-btn ghost" type="button" aria-label="Lock Vault" title="Lock Vault">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
        </svg>
      </button>

      <div class="settings-wrapper">
        <button id="settings-btn" class="btn icon-btn ghost" type="button" aria-label="Settings" title="Settings">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path
              d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
            </path>
          </svg>
        </button>
        <div id="settings-popup" class="settings-popup" hidden>
          <div class="settings-header">Settings</div>
          <div class="settings-body">
            <div class="field">
              <label for="theme-select">Theme</label>
              <select id="theme-select">
                <option value="">Default (Dark)</option>
                <option value="light">Light</option>
                <option value="ultra-dark">Ultra Dark</option>
                <option value="high-contrast">High Contrast</option>
              </select>
            </div>
            <div class="field">
              <label for="settings-max-upload">Max Upload (MB)</label>
              <input id="settings-max-upload" type="number" value="{{ max_upload_mb }}" min="1">
            </div>
            <div class="field">
              <label for="settings-max-storage">Max Storage (MB)</label>
              <input id="settings-max-storage" type="number" value="{{ max_storage_mb }}" min="1">
            </div>
            <div class="field">
              <label for="settings-session-hours">Session Timeout (Hours)</label>
              <input id="settings-session-hours" type="number" value="{{ session_hours }}" min="1">
            </div>
            <div class="settings-actions">
              <button id="save-settings-btn" class="btn primary small" type="button">Save Changes</button>
            </div>
            <div id="settings-status" class="hint" hidden></div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="vault">
    <section class="panel upload">
      <h2>Upload</h2>
      <p class="sub">Drag & drop one or multiple files. They will be encrypted before the upload.</p>
      <div id="drop-zone" class="drop-zone">
        <div class="drop-inner">
          <div class="drop-title">Drop files here</div>
          <div class="drop-sub">or click to browse</div>
        </div>
        <input id="file-input" type="file" multiple />
      </div>
      <div id="upload-queue" class="upload-queue"></div>
      <div id="upload-status" class="hint" hidden></div>
    </section>

    <section class="panel files">
      <div class="files-header">
        <h2>Your Files</h2>
        <button id="new-folder-btn" class="btn ghost small" type="button">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            style="margin-right:6px">
            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
            <line x1="12" y1="11" x2="12" y2="17"></line>
            <line x1="9" y1="14" x2="15" y2="14"></line>
          </svg>
          New Folder
        </button>
      </div>
      <div id="breadcrumb-bar" class="breadcrumb-bar">
        <button class="breadcrumb-item breadcrumb-root active" data-folder-id="">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
          root
        </button>
      </div>
      <div class="storage">
        <div class="storage-labels">
          <span>Storage Used ({{ percent }}%)</span>
          <span>{{ used_bytes|filesizeformat(binary=True) }} / {{ total_bytes|filesizeformat(binary=True) }}</span>
        </div>
        <div class="storage-track">
          <div class="storage-fill" style="width: {{ percent }}%"></div>
        </div>
      </div>
      <div class="filters">
        <div class="search">
          <input id="file-search" type="text" placeholder="Search files..." />
        </div>
        <div class="filter-group">
          <select id="date-filter">
            <option value="all">All dates</option>
            <option value="24h">Last 24h</option>
            <option value="7d">Last 7 days</option>
            <option value="30d">Last 30 days</option>
          </select>
          <select id="size-filter">
            <option value="all">All sizes</option>
            <option value="lt1">Under 1 MB</option>
            <option value="1to10">1–10 MB</option>
            <option value="10to100">10–100 MB</option>
            <option value="gt100">Over 100 MB</option>
          </select>
          <select id="sort-by">
            <option value="newest">Newest first</option>
            <option value="oldest">Oldest first</option>
            <option value="largest">Largest first</option>
            <option value="smallest">Smallest first</option>
          </select>
          <button id="view-toggle" class="btn icon-btn ghost" type="button" aria-label="Toggle View"
            title="Toggle View">
            <svg id="icon-list" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="8" y1="6" x2="21" y2="6"></line>
              <line x1="8" y1="12" x2="21" y2="12"></line>
              <line x1="8" y1="18" x2="21" y2="18"></line>
              <line x1="3" y1="6" x2="3.01" y2="6"></line>
              <line x1="3" y1="12" x2="3.01" y2="12"></line>
              <line x1="3" y1="18" x2="3.01" y2="18"></line>
            </svg>
            <svg id="icon-grid" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" hidden>
              <rect x="3" y="3" width="7" height="7"></rect>
              <rect x="14" y="3" width="7" height="7"></rect>
              <rect x="14" y="14" width="7" height="7"></rect>
              <rect x="3" y="14" width="7" height="7"></rect>
            </svg>
          </button>
        </div>
      </div>
      <div id="file-list" class="file-list">
        <div id="loading-indicator" class="empty">
          <div class="spinner"></div>
          <p>Decrypting vault...</p>
        </div>
      </div>
      <div id="no-results" class="empty" hidden>No files match your filters.</div>
      <div id="empty-state" class="empty" hidden>No files yet. Upload your first file above.</div>

      <template id="file-card-template">
        <div class="file-card appearing">
          <div class="file-main">
            <div class="file-preview">
            </div>
            <div class="file-details">
              <div class="file-name" title=""></div>
              <div class="file-meta"></div>
              <div class="file-meta uploaded-at"></div>
            </div>
          </div>
          <div class="file-actions">
            <div class="file-menu">
              <button class="btn icon-btn ghost file-menu-toggle" type="button" aria-label="File actions"
                title="File actions" aria-haspopup="true" aria-expanded="false">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="5" r="1.5"></circle>
                  <circle cx="12" cy="12" r="1.5"></circle>
                  <circle cx="12" cy="19" r="1.5"></circle>
                </svg>
              </button>
              <div class="file-menu-popup" hidden>
                <button class="file-menu-item rename-btn" type="button">Rename</button>
                <button class="file-menu-item move-btn" type="button">Move to…</button>
                <button class="file-menu-item download-btn" type="button">Download</button>
                <button class="file-menu-item delete-btn danger" type="button">Delete</button>
              </div>
            </div>
          </div>
        </div>
      </template>

      <template id="folder-card-template">
        <div class="file-card folder-card appearing" data-type="folder">
          <div class="file-main">
            <div class="file-preview is-icon folder-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
              </svg>
            </div>
            <div class="file-details">
              <div class="file-name"></div>
              <div class="file-meta"></div>
            </div>
          </div>
          <div class="file-actions">
            <div class="file-menu">
              <button class="btn icon-btn ghost file-menu-toggle" type="button" aria-label="Folder actions"
                title="Folder actions" aria-haspopup="true" aria-expanded="false">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="5" r="1.5"></circle>
                  <circle cx="12" cy="12" r="1.5"></circle>
                  <circle cx="12" cy="19" r="1.5"></circle>
                </svg>
              </button>
              <div class="file-menu-popup" hidden>
                <button class="file-menu-item rename-folder-btn" type="button">Rename</button>
                <button class="file-menu-item move-btn" type="button">Move to…</button>
                <button class="file-menu-item delete-folder-btn danger" type="button">Delete</button>
              </div>
            </div>
          </div>
        </div>
      </template>
    </section>
  </main>

  <div id="delete-modal" class="modal" aria-hidden="true">
    <div class="modal-backdrop" data-close="true"></div>
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="delete-title">
      <h3 id="delete-title">Delete File</h3>
      <p id="delete-message" class="modal-text">Are you sure you want to delete this file?</p>
      <div class="modal-actions">
        <button id="cancel-delete" class="btn ghost" type="button">Cancel</button>
        <button id="confirm-delete" class="btn danger" type="button">Delete</button>
      </div>
    </div>
  </div>
  <div id="rename-modal" class="modal" aria-hidden="true">
    <div class="modal-backdrop" data-close="true"></div>
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="rename-title">
      <h3 id="rename-title">Rename File</h3>
      <div class="field">
        <input id="rename-input" type="text" class="input" placeholder="Enter new name" />
      </div>
      <div class="modal-actions">
        <button id="cancel-rename" class="btn ghost" type="button">Cancel</button>
        <button id="confirm-rename" class="btn primary" type="button">Save</button>
      </div>
    </div>
  </div>

  <div id="image-preview-modal" class="modal image-preview-modal" aria-hidden="true">
    <div class="modal-backdrop" data-close="true"></div>
    <div class="modal-card image-preview-card" role="dialog" aria-modal="true" aria-labelledby="image-preview-title">
      <div class="image-preview-header">
        <p id="image-preview-title" class="image-preview-title">Image Preview</p>
        <button id="close-image-preview" class="btn icon-btn ghost" type="button" aria-label="Close image preview"
          title="Close">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <p id="image-preview-hint" class="image-preview-hint">Loading preview...</p>
      <div class="image-preview-frame">
        <img id="image-preview-img" alt="Image preview" hidden />
      </div>
    </div>
  </div>

  <div id="create-folder-modal" class="modal" aria-hidden="true">
    <div class="modal-backdrop" data-close="true"></div>
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="create-folder-title">
      <h3 id="create-folder-title">New Folder</h3>
      <div class="field">
        <label for="folder-name-input">Folder Name</label>
        <input id="folder-name-input" type="text" class="input" placeholder="Enter folder name" />
      </div>
      <div class="modal-actions">
        <button id="cancel-create-folder" class="btn ghost" type="button">Cancel</button>
        <button id="confirm-create-folder" class="btn primary" type="button">Create</button>
      </div>
    </div>
  </div>

  <div id="move-modal" class="modal" aria-hidden="true">
    <div class="modal-backdrop" data-close="true"></div>
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="move-title">
      <h3 id="move-title">Move Item</h3>
      <p class="modal-text">Select destination folder:</p>
      <div id="move-folder-list" class="move-folder-list"></div>
      <div class="modal-actions">
        <button id="cancel-move" class="btn ghost" type="button">Cancel</button>
        <button id="confirm-move" class="btn primary" type="button">Move Here</button>
      </div>
    </div>
  </div>

  <div id="delete-folder-modal" class="modal" aria-hidden="true">
    <div class="modal-backdrop" data-close="true"></div>
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="delete-folder-title">
      <h3 id="delete-folder-title">Delete Folder</h3>
      <p id="delete-folder-message" class="modal-text">This will permanently delete this folder and all its contents.
        This cannot be undone.</p>
      <div class="modal-actions">
        <button id="cancel-delete-folder" class="btn ghost" type="button">Cancel</button>
        <button id="confirm-delete-folder" class="btn danger" type="button">Delete</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}